---
title: "03_describe.qmd"
format: html
editor: visual
author: "Anna Boateng: s175562, Marlies Goedknegt: s220675, Anne Gjelstrup: s194530, Katja Jagd: s185395, Olivia Ronnenberg: s183359"
---

# Part 04: describe

## Import the required packages

```{r}
#| label: load packages
#| message: false

library("tidyverse")
library("ggthemes")
library("patchwork")
library("gridExtra")

```

```{r}
expr_before_aug <- read_tsv("../data/03_expr_before_aug.tsv.gz",
                                            show_col_types = FALSE)

expr_after_aug <- read_tsv("../data/03_expr_after_aug.tsv.gz",
                                           show_col_types = FALSE)

expr_intersect_aug <- read_tsv("../data/03_expr_intersect_aug.tsv.gz",
                          show_col_types = FALSE)

target_intersect_aug <- read_tsv("../data/03_target_intersect_aug.tsv.gz",
                       show_col_types = FALSE)

coexpression_aug <- read_tsv("../data/03_coexpression_aug.tsv.gz",
                       show_col_types = FALSE)
```

## Description of the data tables

After cleaning and augmenting the data, five data frames will be present:

1.  A table containing the regulator molecules and their respective expression levels before treatment called "03_expr_before_aug".
2.  A table containing the regulator molecules and their respective expression levels after treatment called "03_expr_after_aug".
3.  A table containing twenty co-expression modules and the regulator molecules each contains, called "03_coexpression_aug".
4.  A table containing the regulator molecules, shared between before and after treatment, along with their related target molecules, called "03_target_intersect_aug".
5.  A table containing the regulator molecules, shared between before and after treatment along with their respective expression levels called "03_expr_intersect_aug".

These tables can be found as .tsv.gz files, generated by the previous code.

## Dimensions of the data

For each of the five data tables, the dimensions are listed below.

1.  Table "expr_before_aug": 849 observations and 5 variables.
2.  Table "expr_after_aug": 595 observations and 5 variables.
3.  Table "coexpression_aug": 111700 observations and 2 variables.
4.  Table "target_intersect_aug": 397 observations and 416 variables.
5.  Table "expr_intersect_aug": 397 observations and 8 variables.

These can be analyzed with the code described here.

### Dimensions of table expr_before_aug

```{r}

#| label: data dimensions
#| echo: false

dim(expr_before_aug)
ncol(expr_before_aug)
nrow(expr_before_aug)

```

### Dimensions of table expr_after_aug

```{r}

#| label: data dimensions
#| echo: false

dim(expr_after_aug)
ncol(expr_after_aug)
nrow(expr_after_aug)

```

### Dimensions of table coexpression_aug

```{r}

#| label: data dimensions 
#| echo: false

dim(coexpression_aug)
ncol(coexpression_aug)
nrow(coexpression_aug)

```

### Dimensions of table target_intersect_aug

```{r}

#| label: data dimensions
#| echo: false

dim(target_intersect_aug)
ncol(target_intersect_aug)
nrow(target_intersect_aug)

```

### Dimensions of table expr_intersect_aug

```{r}

#| label: data dimensions
#| echo: false

dim(expr_intersect_aug)
ncol(expr_intersect_aug)
nrow(expr_intersect_aug)

```

## Pie chart of molecule types

The regulator molecules consist of several different types, e.g., cytokines. To depict the distribution of different molecule types, a pie chart can be created with the code described below.

```{r}

#| label: pie chart
#| echo: false

pie_chart <- ggplot(expr_intersect_aug, aes(x = "", fill = molecule_type)) +
  geom_bar(width = 1) +
  coord_polar(theta = "y") +
  geom_label(aes(x = 1.35,label = after_stat(count)), 
            stat = "count", 
            color = "white",
            position = position_stack(vjust = 0.5),
            show.legend = FALSE) +
  labs(
    title = "Distribution of regulator molecule types ",
    fill = "Molecule type",
    x = NULL,
    y = NULL
  ) +
  scale_color_colorblind() + 
  theme_void()

pie_chart

ggsave(filename = "04_pie_chart.png",
       plot = last_plot(),
       device = "png",
       path = "../results", 
       scale = 1,
       limitsize = TRUE)

```

## Boxplot of gene expression levels

The indicate the difference in the expression levels of regulator molecules before and after treatment, a box plot can be created with the code below.

```{r}
#| label: box plot of expression levels 
#| warning: false 

boxplot_before <- expr_before_aug |> 
  ggplot(aes(y = expr_log_ratio_before)) +
  geom_boxplot(show.legend = FALSE,
               fill = "#F8766D",
               color = "#F8766D",
               alpha = 0.5) +
  labs(y = "Expression log ratio",
       subtitle = "Before treatment") +
  theme_minimal(base_size = 12) +
  theme(plot.subtitle = element_text(hjust=0.5)) +
  scale_y_continuous(limits = c(-5,5)) +
  scale_x_continuous(limits = c(-1,1))

boxplot_after <- expr_after_aug |> 
  ggplot(aes(y = expr_log_ratio_after)) +
  geom_boxplot(show.legend = FALSE,
               fill = "#00BFC4",
               color = "#00BFC4",
               alpha = 0.5) +
  labs(y = "Expression log ratio",
       subtitle = "After treatment") +
  theme_minimal(base_size = 12) +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        plot.subtitle = element_text(hjust=0.5)) +
  scale_y_continuous(limits = c(-5,5)) +
  scale_x_continuous(limits = c(-1,1))

boxplot_expr <- boxplot_before + 
  boxplot_after + 
  plot_annotation(title = "Gene expression levels before and after treatment")

boxplot_expr

ggsave(filename = "04_box_plot.png",
       plot = last_plot(),
       device = "png",
       path = "../results",
       scale = 1,
       limitsize = TRUE)

```
