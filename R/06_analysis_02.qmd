---
title: "06_analysis_02.qmd"
format: html
editor: visual
author: "Anna Boateng: s175562, Marlies Goedknegt: s220675, Anne Gjelstrup: s194530, Katja Jagd: s185395, Olivia Ronnenberg: s183359"
---

## Part 06: analysis 2


### Accessing relevant functions

```{r}
#| label: use functions from file

source("99_proj_func.R")
```

### Import required packages

```{r}
#| label: load packages
#| message: false

library("tidyverse")
```

### Plot of target molecules before and after

```{r}
coexpression_aug <- read_tsv("../data/03_coexpression_aug.tsv.gz",
                               show_col_types = FALSE)
```

```{r}
target_aug |> 
  ggplot(aes(y = upstream_regulator,
               x = change_in_n_molecules,
             fill = change_class)) +
  geom_col(color  = "black") + 
   theme_minimal(base_size = 10) +
  theme(legend.position = "bottom",
        axis.text.x = element_text(angle = 55,
                                   hjust = 1,
                                   vjust = 1.1)) +
   scale_fill_manual(values = c("#661100","#117733","black")) +
  geom_hline(yintercept = 0) +
  theme(plot.margin = unit(
    c(1, 0.5, 0.5, 1), "cm"),
    panel.grid.major.x = element_blank()) +
  labs(y = "Upstream regulator",
       x = "Change in number of target molecules",
       title = "Change in the number of target molecules before and after DMARD treatment",
       fill = "Change")
```


### Header for Anne

```{r}
target_aug <- read_tsv("../data/03_target_aug.tsv.gz",
                       show_col_types = FALSE)
```

```{r}
candidate_1 <- module_counter(target_aug, "TREM1")
candidate_2 <- module_counter(target_aug, "LIPE")
candidate_3 <- module_counter(target_aug, "JUND")
```

```{r}
module_analysis <- candidate_1 |> 
  full_join(candidate_2,
            by = 'modules') |> 
  full_join(candidate_3,
            by = 'modules') |> 
  mutate_if(is.numeric,
            replace_na,
            0) |> 
  pivot_longer(cols = -modules,
               names_to = "candidate",
               values_to = "counts") |> 
  arrange(as.integer(str_extract(modules, "\\d+")))
```



```{r}
module_analysis |>
  ggplot(aes(x = fct_inorder(modules), y = counts, fill = candidate)) +
  geom_bar(stat = "identity",
           color = "black",
           alpha = 0.4,
           position = position_dodge(preserve = "single")) +
  geom_hline(yintercept = 0) + 
  
  theme(legend.position = "bottom",
        panel.grid.major.x = element_blank(),
        axis.text.x = element_text(angle = 20,
                                   hjust = 1,
                                   vjust = 1))
```

