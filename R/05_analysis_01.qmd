---
title: "05_analysis_1"
format: html
editor: visual
author: "Anna Boateng: s175562, Marlies Goedknegt: s220675, Anne Gjelstrup: s194530, Katja Jagd: s185395, Olivia Ronnenberg: s183359"
---

## Part 05: analysis 1

The first analysis is that of the genetic expression levels. From the .tsv file "03_expr_aug.tsv.gz", significantly up- and down-regulated genes are depicted below.

#### Load the needed .tsv files

```{r}
#| label: load files

expr_data_before_unfiltered_aug <- read_tsv("../data/03_expr_data_before_unfiltered_aug.tsv.gz",
                               show_col_types = FALSE)

expr_data_after_unfiltered_aug <- read_tsv("../data/03_expr_data_after_unfiltered_aug.tsv.gz",
                               show_col_types = FALSE)

```

#### Load the required packages

```{r}

#| label: load packages
#| message: false
#| echo: false

library("ggrepel")
library("tidyverse")

```

#### Generate a volcano plot of the gene expression

To depict which genes are up- and down-regulated, two volcano plots are made. The first plot indicates the genes significantly up- and down-regulated before DMARD treatment, whereas the second plot depicts the same, but after the treatment. The colors in both plots indicate the genes that are up- and down-regulated, in turquoise and pink respectively. It is important to note that this up- and down-regulation is with respect to the DMARD treatment, over the course of six months.

```{r}

#| label: volcano plot before
#| echo: false


expr_data_before_unfiltered_aug <- expr_data_before_unfiltered_aug |>
  mutate(lbl = case_when(is_significant == "yes" ~ upstream_regulator,
                         is_significant == "no" ~ ""))

plot_before <- expr_data_before_unfiltered_aug |>
  ggplot(aes(x = expr_log_ratio_before,
             y = log10_p_value_before,
             colour = is_significant,
            label = lbl)) + 
  geom_text_repel(size = 3,
                  max.overlaps = 25) + 
  geom_point() +
  xlim(-5, 5) + 
  geom_hline(yintercept = -log10(0.05), linetype = "dotted", color = "black") + 
  geom_vline(xintercept = c(-1.5, 1.5), linetype = "dotted", color = "black") +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "bottom") +
  labs(
    x = "log ratio of gene expression",
    y = "-log10 p.value of expression",
    color = "Effect of treatment",
    title = "Genetic expression in RA patients",
    subtitle = "Before DMARD treatment",
    caption = "Data from DOI: 10.1371/journal.pone.0183928")

plot_before

ggsave(filename = "05_expr_plot_before.png",
       plot = last_plot(),
       device = "png",
       path = "../results",
       scale = 1,
       limitsize = TRUE)

```

```{r}

#| label: volcano plot after
#| echo: false

expr_data_after_unfiltered_aug <- expr_data_after_unfiltered_aug |>
  mutate(lbl = case_when(is_significant == "yes" ~ upstream_regulator,
                         is_significant == "no" ~ ""))

plot_after <- expr_data_after_unfiltered_aug |>
  ggplot(aes(x = expr_log_ratio_after,
             y = log10_p_value_after,
             colour = is_significant,
            label = lbl)) + 
  geom_text_repel(size = 3,
                  max.overlaps = 25) + 
  geom_point() +
  xlim(-5, 5) + 
  geom_hline(yintercept = -log10(0.05), linetype = "dotted", color = "black") + 
  geom_vline(xintercept = c(-1.5, 1.5), linetype = "dotted", color = "black") +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "bottom") +
  labs(
    x = "log ratio of gene expression",
    y = "-log 10  of expression",
    color = "Effect of treatment",
    title = "Genetic expression in RA patients",
    subtitle = "After DMARD treatment",
    caption = "Data from DOI: 10.1371/journal.pone.0183928")

plot_after

ggsave(filename = "05_expr_plot_after.png",
       plot = last_plot(),
       device = "png",
       path = "../results",
       scale = 1,
       limitsize = TRUE)

```

```{r}

#| label: load .tsv file

expr_analysis <- read_tsv("../data/03_expr_aug.tsv.gz",
                      show_col_types = FALSE)

vulcano_plot <- expr_analysis |> 
  ggplot(aes(x = change_in_expr,
             y = upstream_regulator,
             color = regulation)) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dotted", color = "black") +
  theme_minimal(base_size = 12) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    legend.position = "bottom") +
  labs(
    x = "change in gene expression",
    y = "regulator molecule",
    color = "Gene regulation",
    title = "Changes in genetic expression due to treament",
    caption = "Data from DOI: 10.1371/journal.pone.0183928")

vulcano_plot

ggsave(filename = "05_vulcano_plot.png",
       plot = last_plot(),
       device = "png",
       path = "../results",
       scale = 1,
       limitsize = TRUE)

```


